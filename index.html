<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Momentum</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <header class="topbar">
    <div class="wrap topbar__inner">
      <div class="brand">
        <div class="brand__mark" aria-hidden="true"></div>
        <div>
          <div class="brand__title">Momentum</div>
          <div class="brand__subtitle" id="envLabel" hidden>—</div>
        </div>
      </div>

      <div class="topbar__actions" id="signedInActions" hidden>
        <button class="btn" id="btnAddBook" title="Buch hinzufügen">+</button>

        <div class="menu" id="burgerMenu">
          <button class="iconbtn" id="btnMenu" type="button" aria-label="Menü" aria-expanded="false" aria-controls="menuPanel" title="Menü">☰</button>

          <div class="menu__panel" id="menuPanel" hidden>
            <div class="menu__header">
              <div class="menu__headerlabel">Account</div>
              <div class="menu__user">
                <div class="menu__avatar" id="userAvatar" aria-hidden="true">•</div>
                <div class="menu__userinfo">
                  <div class="menu__email" id="chipUser" title="Angemeldet" hidden>—</div>
                </div>
              </div>
            </div>

            <div class="menu__divider" role="separator" aria-hidden="true"></div>

            <div class="menu__group" aria-label="Daten">
              <button class="menuitem" id="btnExport" type="button" title="Daten exportieren">
                <span class="menuitem__left">
                  <svg class="menuitem__icon" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 3v10m0 0l4-4m-4 4L8 9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4 17v3h16v-3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span class="menuitem__title">Export</span>
                </span>
              </button>

              <button class="menuitem" id="btnImport" type="button" title="Daten importieren">
                <span class="menuitem__left">
                  <svg class="menuitem__icon" viewBox="0 0 24 24" aria-hidden="true">
                    <path d="M12 21V11m0 0l4 4m-4-4l-4 4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    <path d="M4 7V4h16v3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                  <span class="menuitem__title">Import</span>
                </span>
              </button>
            </div>

            <div class="menu__divider" role="separator" aria-hidden="true"></div>

            <button class="menuitem" id="btnSwitchEnv" type="button" title="Umgebung wechseln">
              <span class="menuitem__left">
                <svg class="menuitem__icon" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M12 2a7 7 0 00-7 7c0 5 7 13 7 13s7-8 7-13a7 7 0 00-7-7z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M9.5 9.5h5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span class="menuitem__title">Umgebung</span>
              </span>
              <span class="menuitem__meta" id="envPill">PROD</span>
            </button>

            <div class="menu__divider" role="separator" aria-hidden="true"></div>

            <button class="menuitem menuitem--danger" id="btnLogout" type="button" title="Abmelden" hidden>
              <span class="menuitem__left">
                <svg class="menuitem__icon" viewBox="0 0 24 24" aria-hidden="true">
                  <path d="M10 17l-1 0a3 3 0 01-3-3V10a3 3 0 013-3h1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M15 12H21m0 0l-3-3m3 3l-3 3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M10 7V5a2 2 0 012-2h6a2 2 0 012 2v14a2 2 0 01-2 2h-6a2 2 0 01-2-2v-2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span class="menuitem__title">Logout</span>
              </span>
            </button>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Login Screen (overlay) -->
  <div class="authscreen" id="authScreen">
    <div class="panel authpanel">
      <div class="panel__head">
        <h2>Login</h2>
        <div class="panel__meta" id="authEnvMeta">—</div>
      </div>

      <form class="fields" id="formLogin" autocomplete="on">
        <label class="field">
          <span>Email</span>
          <input required name="email" type="email" autocomplete="username" placeholder="name@domain.com" />
        </label>

        <label class="field">
          <span>Passwort</span>
          <input required name="password" type="password" autocomplete="current-password" placeholder="••••••••" />
        </label>

        <div class="modal__actions modal__actions--spread">
          <button class="btn btn--ghost" id="btnSwitchEnvAuth" type="button" title="Zwischen DEV/PROD wechseln">Zu DEV wechseln</button>
          <button class="btn" id="btnLogin" type="submit">Login</button>
        </div>

        <div class="hint hint--error" id="authError" hidden></div>
        <div class="hint">
          Kein Sign-up in der App. Accounts legst du in der Firebase Console an (Authentication → Users).
        </div>
      </form>
    </div>
  </div>


  <main class="wrap grid" id="appMain" hidden>
    <section class="panel">
      <div class="panel__head">
        <h2>Übersicht</h2>
        <div class="panel__meta" id="streakMeta">—</div>
      </div>

      <div class="kpis kpis--top">
        <div class="kpi">
          <div class="kpi__label">Aktueller Streak</div>
          <div class="kpi__value" id="kpiCurrentStreak">0</div>
          <div class="kpi__hint">&nbsp;</div>
        </div>

        <div class="kpi">
          <div class="kpi__label">Längster Streak</div>
          <div class="kpi__value" id="kpiLongestStreak">0</div>
          <div class="kpi__hint" id="kpiLongestHint">—</div>
        </div>

        <div class="kpi">
          <div class="kpi__label">Seiten diese Woche</div>
          <div class="kpi__value" id="kpiWeekPages">0</div>
          <div class="kpi__hint" id="kpiWeekHint">—</div>
        </div>
      </div>

      <button class="togglelink" id="toggleMoreStats" type="button" aria-expanded="false" aria-controls="moreStats">Mehr</button>

      <div id="moreStats" class="kpis kpis--more" hidden>
        <div class="kpi">
          <div class="kpi__label">Seiten heute</div>
          <div class="kpi__value" id="kpiTodayPages">0</div>
          <div class="kpi__hint">&nbsp;</div>
        </div>

        <div class="kpi">
          <div class="kpi__label">Seiten diesen Monat</div>
          <div class="kpi__value" id="kpiMonthPages">0</div>
          <div class="kpi__hint">&nbsp;</div>
        </div>

        <div class="kpi">
          <div class="kpi__label">Seiten dieses Jahr</div>
          <div class="kpi__value" id="kpiYearPages">0</div>
          <div class="kpi__hint">&nbsp;</div>
        </div>

        <div class="kpi">
          <div class="kpi__label">Ø pro aktivem Tag</div>
          <div class="kpi__value" id="kpiAvgPerActiveDay">0</div>
          <div class="kpi__hint">Tage mit &gt; 0 Seiten</div>
        </div>

        <div class="kpi">
          <div class="kpi__label">Ø pro aktivem Monat</div>
          <div class="kpi__value" id="kpiAvgPerActiveMonth">0</div>
          <div class="kpi__hint">Monate mit &gt; 0 Seiten</div>
        </div>

        <div class="kpi">
          <div class="kpi__label">Ø pro aktivem Jahr</div>
          <div class="kpi__value" id="kpiAvgPerActiveYear">0</div>
          <div class="kpi__hint">Jahre mit &gt; 1 Seite</div>
        </div>

        <div class="kpi">
          <div class="kpi__label">Gesamtseiten</div>
          <div class="kpi__value" id="kpiTotalPages">0</div>
          <div class="kpi__hint">über alle Zeit</div>
        </div>

        <div class="kpi">
          <div class="kpi__label">Aktive Tage</div>
          <div class="kpi__value" id="kpiActiveDays">0</div>
          <div class="kpi__hint">Tage mit &gt; 0 Seiten</div>
        </div>

        <div class="kpi">
          <div class="kpi__label">Beste Woche</div>
          <div class="kpi__value" id="kpiBestWeek">0</div>
          <div class="kpi__hint">max. Seiten in 1 Woche</div>
        </div>

        <div class="kpi">
          <div class="kpi__label">Bester Monat</div>
          <div class="kpi__value" id="kpiBestMonth">0</div>
          <div class="kpi__hint">max. Seiten in 1 Monat</div>
        </div>
      </div>

      <div class="divider"></div>

      <div class="chart">
        <div class="chart__head">
          <div>
            <div class="chart__title">Letzte 12 Tage</div>
            <div class="chart__sub" id="subDays">—</div>
          </div>
          <div class="chart__headright">
            <div class="chip" id="sumDays">0</div>
          </div>
        </div>
        <div class="chart__body" id="chartDays"></div>
      </div>

      <button class="togglelink" id="toggleMoreCharts" type="button" aria-expanded="false" aria-controls="moreCharts">Mehr</button>

      <div id="moreCharts" class="charts charts--more" hidden>
        <div class="chart">
          <div class="chart__head">
            <div>
              <div class="chart__title">Letzte 12 Wochen</div>
              <div class="chart__sub" id="subWeeks">—</div>
            </div>
            <div class="chip" id="sumWeeks">0</div>
          </div>
          <div class="chart__body" id="chartWeeks"></div>
        </div>

        <div class="chart">
          <div class="chart__head">
            <div>
              <div class="chart__title">Letzte 12 Monate</div>
              <div class="chart__sub" id="subMonths">—</div>
            </div>
            <div class="chip" id="sumMonths">0</div>
          </div>
          <div class="chart__body" id="chartMonths"></div>
        </div>

        <div class="chart">
          <div class="chart__head">
            <div>
              <div class="chart__title">Letzte 30 Tage</div>
              <div class="chart__sub" id="subDays30">—</div>
            </div>
            <div class="chip" id="sumDays30">0</div>
          </div>
          <div class="chart__body" id="chartDays30"></div>
        </div>

        <div class="chart">
          <div class="chart__head">
            <div>
              <div class="chart__title">Wochentage</div>
              <div class="chart__sub" id="subWeekdays">—</div>
            </div>
            <div class="chip" id="sumWeekdays">0</div>
          </div>
          <div class="chart__body" id="chartWeekdays"></div>
        </div>
      </div>
    </section>
<section class="panel">
      <div class="panel__head panel__head--books">
        <div class="panel__headleft">
          <h2>Bücher</h2>
          <div class="panel__meta" id="booksMeta">—</div>
        </div>
        <div class="panel__headright">
          <input class="search" id="bookSearch" type="search" placeholder="Suchen…" autocomplete="off" />
          <button class="btn btn--ghost" id="btnToggleFinished" type="button">Fertige anzeigen</button>
        </div>
      </div>

      <div id="bookList" class="booklist" aria-live="polite"></div>

      <div class="empty" id="emptyState" hidden>
        <div class="empty__title">Noch keine Bücher</div>
        <div class="empty__text">
          Füge ein Buch hinzu und trage deinen Fortschritt ein. Die Grafiken und der Streak bauen sich automatisch auf.
        </div>
        <button class="btn" id="btnAddBookEmpty">+</button>
      </div>
    </section>
  </main>

  <!-- Add Book Modal -->
  <dialog class="modal" id="dlgAddBook">
    <form method="dialog" class="modal__card" id="formAddBook">
      <div class="modal__head">
        <div>
          <div class="modal__title">Buch hinzufügen</div>
          <div class="modal__sub">Minimal, schnell, ohne Ablenkung</div>
        </div>
        <button class="iconbtn" type="button" id="btnCloseAddBook" aria-label="Schließen">×</button>
      </div>

      <div class="fields">
        <label class="field">
          <span>Titel</span>
          <input required name="title" autocomplete="off" placeholder="z.B. Die Verwandlung" />
        </label>

        <label class="field">
          <span>Autor (optional)</span>
          <input name="author" autocomplete="off" placeholder="z.B. Franz Kafka" />
        </label>

        <label class="field">
          <span>Gesamtseiten</span>
          <input required name="totalPages" inputmode="numeric" type="number" min="1" step="1" placeholder="z.B. 220" />
        </label>

        <label class="field">
          <span>Bereits gelesen (optional)</span>
          <input name="initialPages" inputmode="numeric" type="number" min="0" step="1" placeholder="z.B. 50" />
        </label>
      </div>

      <div class="modal__actions">
        <button class="btn btn--ghost" type="button" id="btnCancelAddBook">Abbrechen</button>
        <button class="btn" id="btnCreateBook" type="submit">Hinzufügen</button>
      </div>
    </form>
  </dialog>

  <!-- Book Detail Modal -->
  <dialog class="modal" id="dlgBook">
    <form method="dialog" class="modal__card modal__card--wide" id="formBook">
      <div class="modal__head">
        <div>
          <div class="modal__title" id="bookTitle">—</div>
          <div class="modal__sub" id="bookSub">—</div>
        </div>
        <button class="iconbtn" type="button" id="btnCloseBookX" aria-label="Schließen">×</button>
      </div>

      <div class="bookdetail">
        <div class="bookdetail__progress">
          <div class="progress">
            <div class="progress__bar" id="bookProgBar" style="width:0%"></div>
          </div>
          <div class="progress__meta">
            <span id="bookProgText">0 / 0</span>
            <span class="muted" id="bookProgPct">0%</span>
          </div>
        </div>

        <div class="bookdetail__update">
          <div class="bookdetail__label">Gelesen bis Seite</div>
          <div class="bookdetail__row">
            <input id="inpDate" type="date" aria-label="Datum" />
            <input id="inpPage" type="number" min="0" step="1" inputmode="numeric" placeholder="z.B. 75" aria-label="Seite" />
            <button class="btn" id="btnSavePage" type="submit">Speichern</button>
          </div>
        </div>

        <div class="bookdetail__history">
          <div class="bookdetail__label">Letzte Einträge</div>
          <div class="history" id="historyList"></div>
        </div>
      </div>

      <div class="modal__actions modal__actions--spread">
        <button class="btn btn--danger" id="btnDeleteBook" type="button">Buch löschen</button>
        <div></div>
      </div>
    </form>
  </dialog>

  <!-- Hidden file input for import -->
  <input type="file" id="fileImport" accept="application/json" hidden />

  <div class="toast" id="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <script type="module" src="./app.js"></script>
</body>
</html>
